# 数据与物理混合驱动下的物理场预测模型

## 概述（背景）

我们探讨了一种结合数据驱动和物理驱动方法，使用深度卷积神经网络（CNN）来预测稳态热传导问题。在传统的数值方法（如有限体积/元素/差分方法，例如计算流体动力学CFD）中，计算物理场的解通常需要对大量候选设计或操作条件进行计算，这导致了巨大的计算成本。相比之下，机器学习中的神经网络可以作为替代模型，以现实的计算成本获得足够准确的解。我们选择稳态热传导的解作为算例，其物理定律可以用二阶偏微分方程（PDE）表示，即拉普拉斯方程。专注于这个问题，我们将首先使用的是 CNN 架构和原始数据驱动和物理驱动方法。

## 目标

案例的目标是比较数据驱动和物理驱动学习方法在深度CNN中的应用，并提出一种结合这两种方法的学习方法，以加速学习过程并提高解的准确性。具体来说，目标是通过引入加权损失函数，同时利用参考数据和物理方程来驱动学习，从而提高预测物理场的效率和准确性。

## 数据集的获取和处理

- 数据驱动方法中，数据集是通过传统的数值解法（如有限体积法FVM）生成的，每个数值解被插值到128×128的网格中，以适应学习域的分辨率。
- 物理驱动方法（如物理信息神经网络PINN）不需要标记数据，而是通过将偏微分方程（PDE）引入损失函数来训练模型，以获得满足物理定律的解。
- 在提出的结合方法中，使用了两种不同的数据集：一种是单样本数据集，另一种包含多个样本。数据集通过改变5个边界的温度（0/0.5/1）、孔的形状（正方形/圆形）和位置（9个不同位置）来获得，总共有35×2×9=4374个样本。这些样本被随机分成训练集和测试集，比例为80/20。
- 数据增强通过基本的几何变换（如翻转和旋转）来实现，这些变换虽然不会像收集其他配置那样增加太多变异性，但它们是减少过拟合和提高训练模型泛化的廉价且快速的方法。

数据集的处理包括将几何和边界条件作为输入层的方阵输入到CNN架构中，然后通过卷积计算层逐层进行编码。在编码过程中，输入矩阵的值通过卷积计算逐步下采样，随着特征通道数的增加，提取了大规模信息。最终，输入的压缩编码被获得，并表示为1×1大小的256通道特征图。然后通过一系列解码层镜像编码过程，随着空间分辨率的增加和特征通道数的减少，重建了解。最终输出只有一个通道，给出温度场。此外，还有编码和解码块之间的连接操作，这些跳跃连接有效地将每个解码块的特征通道数加倍，并使神经网络能够考虑编码层的信息。

### 原始数据驱动方法的损失函数（Mean Absolute Error, MAE）

![](images/data.png)

### 热传导的物理定律，二维稳态热传导方程（Laplace方程）

![](images/phy.png)

### 物理驱动方法的总物理损失

![](images/phy1.png)

### 组合方法的加权损失函数

![](images/combined.png)

其中 R 是一个手动选择的常数超参数，用于调整不同损失项的值。

### 原始数据驱动方法和组合方法比较

![](images/001.png)

![](images/002.png)

 在单案例训练中，使用原始数据驱动方法和组合方法时，Laplace残差（LR）和整体误差（E）的变化。组合方法在LR的收敛速度上有显著提升，表明了组合方法能够更快地学习到满足物理定律的解。组合方法将迭代步数从原始数据驱动方法的684步减少到267步，加速了60.9%。

![](images/r1.png)

使用原始数据驱动方法和组合方法得到的CNN输出以及局部Laplace残差。当两种方法的整体误差（E）相近时，组合方法得到的局部结构具有更好的物理一致性，即局部Laplace残差更小，温度分布的轮廓更平滑。

![](images/r10.png)

这幅图显示了五种不同的参考目标，包括真实的温度分布（Ttrue）、零温度分布（Tzero）以及三种不同粗糙度的温度分布（Tcoarse、Tsystematic、Trandom）。物理驱动基础训练中，使用不同粗糙度的参考目标，组合方法相比于原始物理驱动方法，训练速度提升最高可达49.0%。

## 快速开始

从[dataset](https://download.mindspore.cn/mindscience/mindflow/dataset/applications/research/allen_cahn/) 中下载验证所需要的数据集，并保存在`./dataset`目录下。

### 训练方式一：在命令行中调用`train.py`脚本

`python train.py --mode GRAPH --device_target Ascend --device_id 0 --config_file_path ./configs/combined_methods.yaml`

其中，
`--mode`表示运行的模式，'GRAPH'表示静态图模式, 'PYNATIVE'表示动态图模式，详见[MindSpore官网](https://www.mindspore.cn/docs/zh-CN/r2.0.0-alpha/design/dynamic_graph_and_static_graph.html?highlight=pynative)，默认值'GRAPH'；

`--device_target`表示使用的计算平台类型，可以选择'Ascend'或'GPU'，默认值'Ascend'；

`--device_id`表示使用的计算卡编号，可按照实际情况填写，默认值0；

`--config_file_path`表示参数文件的路径，默认值'./configs/combined_methods.yaml'；

计算平台类型需要用到Ascend

### 训练方式二：运行Jupyter Notebook

您可以使用[中文版](allen_cahn_CN.ipynb)和[英文版](allen_cahn.ipynb) Jupyter Notebook逐行运行训练和验证代码。

## 结果展示

<img src="images/plot1.png" style="zoom:50%;" />

<img src="images/plot2.png" style="zoom:50%;" />

第一张为输入初始温度场图片，第二张为预测温度场图片。

## 性能

| 参数          | Acsend          | GPU             |
| ------------- | --------------- | --------------- |
| 硬件资源      | Ascend          | 910A            |
| MindSpore版本 | MindSpore2.2.12 | MindSpore2.2.12 |
| 训练损失      | 0.001           | 0.001           |
| 验证损失      | 0.001           | 0.001           |
| 速度          | 0.9s/epoch      | 0.9s/epoch      |

## Contributor

gitee id：ZYF00000

email: zhzyf@zua.edu.cn
