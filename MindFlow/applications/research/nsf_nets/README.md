# NSFNets: Physics-informed neural networks for the incompressible Navier-Stokes equations

## Background 1

In the industrial application of AI-CFD, the scenarios for solving the NavierStokes equations and fusing multi-precision data are very extensive and have important economic and social significance. Solving ill-posed problems (such as missing some boundary conditions) or inversion problems is one of the key points and difficulties, and it is often costly, requiring the derivation of different formulas applicable to specific problems and the writing of new codes. How to solve the above problems with a set of unified codes at the same computational cost urgently needs in-depth research. Here, Jin Xiaowei, Li Hui and others used physical information neural networks (PINNs) to encode the control equations directly into deep neural networks through automatic differentiation to overcome some of the above-mentioned limitations of simulating incompressible laminar and turbulent flows. And developed Navier-Stokes flow networks (NSFnets, Navier-Stokes flow nets)..

## Model framework

The model framework is as shown in the following figure:

![NSFNet](images/NSFNet.png)

The figure shows the network for solving the Navier-Stokes equations in the pressure-velocity form. The automatic differentiation of the neural network is used to calculate the partial derivatives required in the equation. The loss function includes boundary condition loss, initial condition loss, and physical loss to satisfy the balance of the equation.

## QuickStart

The dataset can be directly generated by the provided code.

The case provides two training methods

- Run Option 1: Call `train.py` from command line

  ```python
  # Call `train.py` from command line
  python train.py --device_target GPU --device_id 0 --config_file_path ./config/NSFNet.yaml

  ```

  `--config_path` indicates the path of the parameter file. Default path "./config/config.yaml".

  In the "./config/config.yaml" parameter file:

  'case' represents the case name;

  'device' representsthe type of computing platform used, with options of 'CPU', 'GPU', or 'Ascend', with a default value of 'GPU';

  'device_id' represents the index of NPU or GPU. Default 0;

  'network_size' represents the size of network；

  'learning_rate' represents the learning rate；

  'epochs' represents number of training iterations；

- Run Option 2: Run Jupyter Notebook

  You can use [chinese](./NSFNets_CN.ipynb) or [English](./NSFNets.ipynb) Jupyter Notebook to run the training and evaluation code line-by-line.

## Case description

The Jupyter Notebook named NSFNets runs the case of the three-dimensional Beltrami flow. In addition to providing the running code and data of this equation, this open source also provides the two-dimensional Kovasznay flow, which can be run directly by calling the `train_KF.py` script in the command line.

## Performance

|        Parameters         |           GPU           |        NPU         |
|:-------------------------:|:-----------------------:|:------------------:|
|         hardware          | NVIDIA 1080Ti(memory 11G) | Ascend(memory 32G) |
|     MindSpore version     |         2.2.14          |       2.2.14       |
|         data_size         |          91648          |       91648        |
|        batch_size         |           10000         |        10000       |
|          epochs           |           11w           |        11w         |
|         optimizer         |         Adam            |        Adam        |
|  total loss ((MSE)        |         2.6e-3          |       3.3e-4       |
|  boundary loss ((MSE)     |         5.9e-6          |       1.0e-5       |
|  equation loss ((MSE)     |         2.6e-6          |       6.3e-6       |
|  regularization loss((MSE)|         1.8e-3          |       1.8e-3       |
|       speed(s/step)       |          0.43           |        0.068       |

## Contributor

gitee id: [chenchao2024](https://gitee.com/chenchao2024)
email: chenchao@isrc.iscas.ac.cn

## Reference

Jin x, Cai s, Li H, Karniadakis G. NSFnets (Navier-Stokes flow nets): Physics-informed neural networks for the incompressible Navier-Stokes equations[J]. Journal of Computational Physics, 2020, 426: 1. https://doi.org/10.1016/j.jcp.2020.109951
