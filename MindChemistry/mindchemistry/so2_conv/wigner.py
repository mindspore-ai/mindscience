# Copyright 2024 Huawei Technologies Co., Ltd
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
# http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
# ============================================================================
"""
wigner file
"""

# pylint: disable=C0103

from mindspore import ops
import mindspore as ms
from mindchemistry.e3.utils.func import broadcast_args


def wigner_D(lv, alpha, beta, gamma):
    """
    # Borrowed from e3nn @ 0.4.0:
    # https://github.com/e3nn/e3nn/blob/0.4.0/e3nn/o3/_wigner.py#L10
    # jd is a list of tensors of shape (2l+1, 2l+1)

    # Borrowed from e3nn @ 0.4.0:
    # https://github.com/e3nn/e3nn/blob/0.4.0/e3nn/o3/_wigner.py#L37
    #
    # In 0.5.0, e3nn shifted to torch.matrix_exp which is significantly slower:
    # https://github.com/e3nn/e3nn/blob/0.5.0/e3nn/o3/_wigner.py#L92
    """
    jd = (
        ms.Tensor([[1.0]]),
        ms.Tensor([[0.0, -1.0, 0.0], [-1.0, 0.0, 0.0], [0.0, 0.0, 1.0]]),
        ms.Tensor([[0.0, 0.0, 0.0, -1.0, 0.0], [0.0, 1.0, 0.0, 0.0, 0.0],
                   [0.0, 0.0, -0.5, 0.0, -0.8660254037844386],
                   [-1.0, 0.0, 0.0, 0.0, 0.0],
                   [0.0, 0.0, -0.8660254037844386, 0.0, 0.5]]),
        ms.Tensor([
            [0.0, 0.0, 0.0, 0.7905694150420949, 0.0, -0.6123724356957945, 0.0],
            [0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0],
            [0.0, 0.0, 0.0, 0.6123724356957945, 0.0, 0.7905694150420949, 0.0],
            [0.7905694150420949, 0.0, 0.6123724356957945, 0.0, 0.0, 0.0, 0.0],
            [0.0, 0.0, 0.0, 0.0, -0.25, 0.0, -0.9682458365518543],
            [-0.6123724356957945, 0.0, 0.7905694150420949, 0.0, 0.0, 0.0, 0.0],
            [0.0, 0.0, 0.0, 0.0, -0.9682458365518543, 0.0, 0.25]
        ]),
        ms.Tensor(
            [[
                0.0, 0.0, 0.0, 0.0, 0.0, 0.9354143466934853, 0.0,
                -0.3535533905932738, 0.0
            ], [0.0, 0.75, 0.0, -0.6614378277661477, 0.0, 0.0, 0.0, 0.0, 0.0],
             [
                 0.0, 0.0, 0.0, 0.0, 0.0, 0.3535533905932738, 0.0,
                 0.9354143466934853, 0.0
             ],
             [0.0, -0.6614378277661477, 0.0, -0.75, 0.0, 0.0, 0.0, 0.0, 0.0],
             [
                 0.0, 0.0, 0.0, 0.0, 0.375, 0.0, 0.5590169943749475, 0.0,
                 0.739509972887452
             ],
             [
                 0.9354143466934853, 0.0, 0.3535533905932738, 0.0, 0.0, 0.0,
                 0.0, 0.0, 0.0
             ],
             [
                 0.0, 0.0, 0.0, 0.0, 0.5590169943749475, 0.0, 0.5, 0.0,
                 -0.6614378277661477
             ],
             [
                 -0.3535533905932738, 0.0, 0.9354143466934853, 0.0, 0.0, 0.0,
                 0.0, 0.0, 0.0
             ],
             [
                 0.0, 0.0, 0.0, 0.0, 0.739509972887452, 0.0,
                 -0.6614378277661477, 0.0, 0.125
             ]]),
        ms.Tensor([[
            0.0, 0.0, 0.0, 0.0, 0.0, -0.701560760020114, 0.0,
            0.6846531968814576, 0.0, -0.19764235376052372, 0.0
        ],
                   [
                       0.0, 0.5, 0.0, -0.8660254037844386, 0.0, 0.0, 0.0, 0.0,
                       0.0, 0.0, 0.0
                   ],
                   [
                       0.0, 0.0, 0.0, 0.0, 0.0, -0.5229125165837972, 0.0,
                       -0.30618621784789724, 0.0, 0.795495128834866, 0.0
                   ],
                   [
                       0.0, -0.8660254037844386, 0.0, -0.5, 0.0, 0.0, 0.0, 0.0,
                       0.0, 0.0, 0.0
                   ],
                   [
                       0.0, 0.0, 0.0, 0.0, 0.0, -0.4841229182759271, 0.0,
                       -0.6614378277661477, 0.0, -0.57282196186948, 0.0
                   ],
                   [
                       -0.701560760020114, 0.0, -0.5229125165837972, 0.0,
                       -0.4841229182759271, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0
                   ],
                   [
                       0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.125, 0.0,
                       0.4050462936504913, 0.0, 0.9057110466368399
                   ],
                   [
                       0.6846531968814576, 0.0, -0.30618621784789724, 0.0,
                       -0.6614378277661477, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0
                   ],
                   [
                       0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.4050462936504913, 0.0,
                       0.8125, 0.0, -0.4192627457812106
                   ],
                   [
                       -0.19764235376052372, 0.0, 0.795495128834866, 0.0,
                       -0.57282196186948, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0
                   ],
                   [
                       0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.9057110466368399, 0.0,
                       -0.4192627457812106, 0.0, 0.0625
                   ]]),
        ms.Tensor(
            [[
                0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -0.879452954966893, 0.0,
                0.46351240544347894, 0.0, -0.10825317547305482, 0.0
            ],
             [
                 0.0, 0.3125, 0.0, -0.8028270361665706, 0.0,
                 0.5077524002897476, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0
             ],
             [
                 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -0.4330127018922193, 0.0,
                 -0.6846531968814576, 0.0, 0.5863019699779287, 0.0
             ],
             [
                 0.0, -0.8028270361665706, 0.0, 0.0625, 0.0,
                 0.5929270612815711, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0
             ],
             [
                 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -0.19764235376052372, 0.0,
                 -0.5625, 0.0, -0.8028270361665706, 0.0
             ],
             [
                 0.0, 0.5077524002897476, 0.0, 0.5929270612815711, 0.0, 0.625,
                 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0
             ],
             [
                 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -0.3125, 0.0,
                 -0.45285552331841994, 0.0, -0.49607837082461076, 0.0,
                 -0.6716932893813962
             ],
             [
                 -0.879452954966893, 0.0, -0.4330127018922193, 0.0,
                 -0.19764235376052372, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0
             ],
             [
                 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -0.45285552331841994, 0.0,
                 -0.53125, 0.0, -0.1711632992203644, 0.0, 0.6952686081652184
             ],
             [
                 0.46351240544347894, 0.0, -0.6846531968814576, 0.0, -0.5625,
                 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0
             ],
             [
                 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -0.49607837082461076, 0.0,
                 -0.1711632992203644, 0.0, 0.8125, 0.0, -0.2538762001448738
             ],
             [
                 -0.10825317547305482, 0.0, 0.5863019699779287, 0.0,
                 -0.8028270361665706, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0
             ],
             [
                 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -0.6716932893813962, 0.0,
                 0.6952686081652184, 0.0, -0.2538762001448738, 0.0, 0.03125
             ]]),
        ms.Tensor([[
            0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.6472598492877494, 0.0,
            -0.6991205412874092, 0.0, 0.2981060004427955, 0.0,
            -0.05846339666834283, 0.0
        ],
                   [
                       0.0, 0.1875, 0.0, -0.6373774391990981, 0.0,
                       0.7473912964438374, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                       0.0, 0.0
                   ],
                   [
                       0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.47495887979908324,
                       0.0, 0.07328774624724109, 0.0, -0.78125, 0.0,
                       0.3983608994994363, 0.0
                   ],
                   [
                       0.0, -0.6373774391990981, 0.0, 0.5, 0.0,
                       0.5863019699779287, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                       0.0, 0.0
                   ],
                   [
                       0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.42961647140211,
                       0.0, 0.4198446513295126, 0.0, -0.10364452469860624, 0.0,
                       -0.7927281808728639, 0.0
                   ],
                   [
                       0.0, 0.7473912964438374, 0.0, 0.5863019699779287, 0.0,
                       0.3125, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0
                   ],
                   [
                       0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.41339864235384227,
                       0.0, 0.5740991584648074, 0.0, 0.5385527481129402, 0.0,
                       0.4576818286211503, 0.0
                   ],
                   [
                       0.6472598492877494, 0.0, 0.47495887979908324, 0.0,
                       0.42961647140211, 0.0, 0.41339864235384227, 0.0, 0.0,
                       0.0, 0.0, 0.0, 0.0, 0.0, 0.0
                   ],
                   [
                       0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -0.078125, 0.0,
                       -0.24356964481437338, 0.0, -0.4487939567607835, 0.0,
                       -0.8562442974262661
                   ],
                   [
                       -0.6991205412874092, 0.0, 0.07328774624724109, 0.0,
                       0.4198446513295126, 0.0, 0.5740991584648074, 0.0, 0.0,
                       0.0, 0.0, 0.0, 0.0, 0.0, 0.0
                   ],
                   [
                       0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                       -0.24356964481437338, 0.0, -0.609375, 0.0,
                       -0.5700448858423344, 0.0, 0.4943528756111367
                   ],
                   [
                       0.2981060004427955, 0.0, -0.78125, 0.0,
                       -0.10364452469860624, 0.0, 0.5385527481129402, 0.0, 0.0,
                       0.0, 0.0, 0.0, 0.0, 0.0, 0.0
                   ],
                   [
                       0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                       -0.4487939567607835, 0.0, -0.5700448858423344, 0.0,
                       0.671875, 0.0, -0.14905300022139775
                   ],
                   [
                       -0.05846339666834283, 0.0, 0.3983608994994363, 0.0,
                       -0.7927281808728639, 0.0, 0.4576818286211503, 0.0, 0.0,
                       0.0, 0.0, 0.0, 0.0, 0.0, 0.0
                   ],
                   [
                       0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                       -0.8562442974262661, 0.0, 0.4943528756111367, 0.0,
                       -0.14905300022139775, 0.0, 0.015625
                   ]]),
        ms.Tensor([[
            0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.8356088723200586,
            0.0, -0.516334738808072, 0.0, 0.184877493221863, 0.0, -0.03125, 0.0
        ],
                   [
                       0.0, 0.109375, 0.0, -0.4621937330546575, 0.0,
                       0.7745021082121081, 0.0, -0.4178044361600293, 0.0, 0.0,
                       0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0
                   ],
                   [
                       0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                       0.4576818286211503, 0.0, 0.47134697278119864, 0.0,
                       -0.7088310138883597, 0.0, 0.2567449488305466, 0.0
                   ],
                   [
                       0.0, -0.4621937330546575, 0.0, 0.703125, 0.0,
                       0.2181912506838897, 0.0, -0.4943528756111367, 0.0, 0.0,
                       0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0
                   ],
                   [
                       0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                       0.27421763710600383, 0.0, 0.6051536478449089, 0.0,
                       0.338020432074749, 0.0, -0.6665852814906732, 0.0
                   ],
                   [
                       0.0, 0.7745021082121081, 0.0, 0.2181912506838897, 0.0,
                       -0.265625, 0.0, -0.5310201708739509, 0.0, 0.0, 0.0, 0.0,
                       0.0, 0.0, 0.0, 0.0, 0.0
                   ],
                   [
                       0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                       0.1307281291459493, 0.0, 0.38081430021731066, 0.0,
                       0.5908647000371574, 0.0, 0.6991205412874092, 0.0
                   ],
                   [
                       0.0, -0.4178044361600293, 0.0, -0.4943528756111367, 0.0,
                       -0.5310201708739509, 0.0, -0.546875, 0.0, 0.0, 0.0, 0.0,
                       0.0, 0.0, 0.0, 0.0, 0.0
                   ],
                   [
                       0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.2734375, 0.0,
                       0.3921843874378479, 0.0, 0.4113264556590057, 0.0,
                       0.4576818286211503, 0.0, 0.6267066542400439
                   ],
                   [
                       0.8356088723200586, 0.0, 0.4576818286211503, 0.0,
                       0.27421763710600383, 0.0, 0.1307281291459493, 0.0, 0.0,
                       0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0
                   ],
                   [
                       0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                       0.3921843874378479, 0.0, 0.5, 0.0, 0.32775276505317236,
                       0.0, 0.0, 0.0, -0.6991205412874092
                   ],
                   [
                       -0.516334738808072, 0.0, 0.47134697278119864, 0.0,
                       0.6051536478449089, 0.0, 0.38081430021731066, 0.0, 0.0,
                       0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0
                   ],
                   [
                       0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                       0.4113264556590057, 0.0, 0.32775276505317236, 0.0,
                       -0.28125, 0.0, -0.7302075903467452, 0.0,
                       0.3332926407453366
                   ],
                   [
                       0.184877493221863, 0.0, -0.7088310138883597, 0.0,
                       0.338020432074749, 0.0, 0.5908647000371574, 0.0, 0.0,
                       0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0
                   ],
                   [
                       0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                       0.4576818286211503, 0.0, 0.0, 0.0, -0.7302075903467452,
                       0.0, 0.5, 0.0, -0.0855816496101822
                   ],
                   [
                       -0.03125, 0.0, 0.2567449488305466, 0.0,
                       -0.6665852814906732, 0.0, 0.6991205412874092, 0.0, 0.0,
                       0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0
                   ],
                   [
                       0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                       0.6267066542400439, 0.0, -0.6991205412874092, 0.0,
                       0.3332926407453366, 0.0, -0.0855816496101822, 0.0,
                       0.0078125
                   ]]),
        ms.Tensor([[
            0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -0.6090493921755238,
            0.0, 0.6968469725305549, 0.0, -0.3615761395439417, 0.0,
            0.11158481919598204, 0.0, -0.016572815184059706, 0.0
        ],
                   [
                       0.0, 0.0625, 0.0, -0.3156095293238149, 0.0,
                       0.6817945071647321, 0.0, -0.656993626300895, 0.0, 0.0,
                       0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0
                   ],
                   [
                       0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                       -0.44314852502786806, 0.0, 0.05633673867912483, 0.0,
                       0.6723290616859426, 0.0, -0.5683291712335379, 0.0,
                       0.15944009087467617, 0.0
                   ],
                   [
                       0.0, -0.3156095293238149, 0.0, 0.71875, 0.0,
                       -0.20252314682524564, 0.0, -0.5854685623498498, 0.0,
                       0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0
                   ],
                   [
                       0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                       -0.39636409043643195, 0.0, -0.25194555463432966, 0.0,
                       0.3921843874378479, 0.0, 0.6051536478449089, 0.0,
                       -0.5093126879064569, 0.0
                   ],
                   [
                       0.0, 0.6817945071647321, 0.0, -0.20252314682524564, 0.0,
                       -0.5625, 0.0, -0.4215855488510013, 0.0, 0.0, 0.0, 0.0,
                       0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0
                   ],
                   [
                       0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                       -0.3754879637718099, 0.0, -0.42961647140211, 0.0,
                       -0.13799626353637262, 0.0, 0.2981060004427955, 0.0,
                       0.7526807559068452, 0.0
                   ],
                   [
                       0.0, -0.656993626300895, 0.0, -0.5854685623498498, 0.0,
                       -0.4215855488510013, 0.0, -0.21875, 0.0, 0.0, 0.0, 0.0,
                       0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0
                   ],
                   [
                       0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                       -0.36685490255855924, 0.0, -0.5130142237306876, 0.0,
                       -0.4943528756111367, 0.0, -0.4576818286211503, 0.0,
                       -0.38519665736315783, 0.0
                   ],
                   [
                       -0.6090493921755238, 0.0, -0.44314852502786806, 0.0,
                       -0.39636409043643195, 0.0, -0.3754879637718099, 0.0,
                       -0.36685490255855924, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                       0.0, 0.0, 0.0
                   ],
                   [
                       0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                       0.0546875, 0.0, 0.16792332234534904, 0.0,
                       0.2954323500185787, 0.0, 0.4624247721758373, 0.0,
                       0.8171255055356399
                   ],
                   [
                       0.6968469725305549, 0.0, 0.05633673867912483, 0.0,
                       -0.25194555463432966, 0.0, -0.42961647140211, 0.0,
                       -0.5130142237306876, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                       0.0, 0.0, 0.0
                   ],
                   [
                       0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                       0.16792332234534904, 0.0, 0.453125, 0.0,
                       0.577279787559724, 0.0, 0.38725105410605404, 0.0,
                       -0.5322256665703469
                   ],
                   [
                       -0.3615761395439417, 0.0, 0.6723290616859426, 0.0,
                       0.3921843874378479, 0.0, -0.13799626353637262, 0.0,
                       -0.4943528756111367, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                       0.0, 0.0, 0.0
                   ],
                   [
                       0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                       0.2954323500185787, 0.0, 0.577279787559724, 0.0,
                       0.140625, 0.0, -0.7162405240429014, 0.0,
                       0.21608307321780204
                   ],
                   [
                       0.11158481919598204, 0.0, -0.5683291712335379, 0.0,
                       0.6051536478449089, 0.0, 0.2981060004427955, 0.0,
                       -0.4576818286211503, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                       0.0, 0.0, 0.0
                   ],
                   [
                       0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                       0.4624247721758373, 0.0, 0.38725105410605404, 0.0,
                       -0.7162405240429014, 0.0, 0.34765625, 0.0,
                       -0.048317644050206957
                   ],
                   [
                       -0.016572815184059706, 0.0, 0.15944009087467617, 0.0,
                       -0.5093126879064569, 0.0, 0.7526807559068452, 0.0,
                       -0.38519665736315783, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                       0.0, 0.0, 0.0
                   ],
                   [
                       0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                       0.8171255055356399, 0.0, -0.5322256665703469, 0.0,
                       0.21608307321780204, 0.0, -0.048317644050206957, 0.0,
                       0.00390625
                   ]]),
        ms.Tensor(
            [[
                0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                -0.800447720175637, 0.0, 0.5437971423529642, 0.0,
                -0.24319347525427157, 0.0, 0.06594508990677396, 0.0,
                -0.008734640537108554, 0.0
            ],
             [
                 0.0, 0.03515625, 0.0, -0.20644078533943455, 0.0,
                 0.5437971423529642, 0.0, -0.7295804257628147, 0.0,
                 0.35797110294949086, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                 0.0, 0.0, 0.0
             ],
             [
                 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                 -0.4645646483537033, 0.0, -0.3156095293238149, 0.0,
                 0.7057243619147634, 0.0, -0.42100604954085874, 0.0,
                 0.09631896879639025, 0.0
             ],
             [
                 0.0, -0.20644078533943455, 0.0, 0.62890625, 0.0,
                 -0.5041938375082048, 0.0, -0.3543293897015177, 0.0,
                 0.4267298778757764, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                 0.0, 0.0, 0.0
             ],
             [
                 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                 -0.31049159295683837, 0.0, -0.5390625, 0.0,
                 0.017469281074217108, 0.0, 0.6925528980529664, 0.0,
                 -0.36479021288140734, 0.0
             ],
             [
                 0.0, 0.5437971423529642, 0.0, -0.5041938375082048, 0.0,
                 -0.484375, 0.0, 0.034938562148434216, 0.0, 0.462853538862457,
                 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0
             ],
             [
                 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                 -0.19515618744994995, 0.0, -0.4861359120657514, 0.0,
                 -0.49410588440130926, 0.0, -0.09110862335695782, 0.0,
                 0.6878550219704731, 0.0
             ],
             [
                 0.0, -0.7295804257628147, 0.0, -0.3543293897015177, 0.0,
                 0.034938562148434216, 0.0, 0.328125, 0.0, 0.4829869223773041,
                 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0
             ],
             [
                 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                 -0.09472152853892297, 0.0, -0.27885262964960544, 0.0,
                 -0.44538102542935076, 0.0, -0.574869423013283, 0.0,
                 -0.6200241379499873, 0.0
             ],
             [
                 0.0, 0.35797110294949086, 0.0, 0.4267298778757764, 0.0,
                 0.462853538862457, 0.0, 0.4829869223773041, 0.0, 0.4921875,
                 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0
             ],
             [
                 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -0.24609375,
                 0.0, -0.3512368283228746, 0.0, -0.3618292555284191, 0.0,
                 -0.38377788032373783, 0.0, -0.4306629552848579, 0.0,
                 -0.5936279171365733
             ],
             [
                 -0.800447720175637, 0.0, -0.4645646483537033, 0.0,
                 -0.31049159295683837, 0.0, -0.19515618744994995, 0.0,
                 -0.09472152853892297, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                 0.0, 0.0, 0.0, 0.0
             ],
             [
                 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                 -0.3512368283228746, 0.0, -0.46484375, 0.0,
                 -0.3661888014143114, 0.0, -0.18922142726223226, 0.0,
                 0.10058119679362292, 0.0, 0.6932080600734395
             ],
             [
                 0.5437971423529642, 0.0, -0.3156095293238149, 0.0, -0.5390625,
                 0.0, -0.4861359120657514, 0.0, -0.27885262964960544, 0.0, 0.0,
                 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0
             ],
             [
                 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                 -0.3618292555284191, 0.0, -0.3661888014143114, 0.0, 0.015625,
                 0.0, 0.4585145534256519, 0.0, 0.6137165055779011, 0.0,
                 -0.38452264694764726
             ],
             [
                 -0.24319347525427157, 0.0, 0.7057243619147634, 0.0,
                 0.017469281074217108, 0.0, -0.49410588440130926, 0.0,
                 -0.44538102542935076, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                 0.0, 0.0, 0.0, 0.0
             ],
             [
                 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                 -0.38377788032373783, 0.0, -0.18922142726223226, 0.0,
                 0.4585145534256519, 0.0, 0.462890625, 0.0,
                 -0.6114934630648914, 0.0, 0.13594928558824104
             ],
             [
                 0.06594508990677396, 0.0, -0.42100604954085874, 0.0,
                 0.6925528980529664, 0.0, -0.09110862335695782, 0.0,
                 -0.574869423013283, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                 0.0, 0.0, 0.0, 0.0
             ],
             [
                 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                 -0.4306629552848579, 0.0, 0.10058119679362292, 0.0,
                 0.6137165055779011, 0.0, -0.6114934630648914, 0.0, 0.23046875,
                 0.0, -0.026921970218926214
             ],
             [
                 -0.008734640537108554, 0.0, 0.09631896879639025, 0.0,
                 -0.36479021288140734, 0.0, 0.6878550219704731, 0.0,
                 -0.6200241379499873, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                 0.0, 0.0, 0.0, 0.0
             ],
             [
                 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                 -0.5936279171365733, 0.0, 0.6932080600734395, 0.0,
                 -0.38452264694764726, 0.0, 0.13594928558824104, 0.0,
                 -0.026921970218926214, 0.0, 0.001953125
             ]]),
        ms.Tensor([[
            0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
            0.5799794739346789, 0.0, -0.6887500841864173, 0.0,
            0.4032907544404998, 0.0, -0.1584741601909983, 0.0,
            0.038323079824899575, 0.0, -0.004580484140452568, 0.0
        ],
                   [
                       0.0, 0.01953125, 0.0, -0.1307281291459493, 0.0,
                       0.4054416537188952, 0.0, -0.6878550219704731, 0.0,
                       0.5873680453541246, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                       0.0, 0.0, 0.0, 0.0, 0.0, 0.0
                   ],
                   [
                       0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                       0.41975832570891686, 0.0, -0.13594928558824104, 0.0,
                       -0.5572262544360347, 0.0, 0.636036888060459, 0.0,
                       -0.2950124033243931, 0.0, 0.05695963504460033, 0.0
                   ],
                   [
                       0.0, -0.1307281291459493, 0.0, 0.5, 0.0,
                       -0.6461272852542291, 0.0, 0.0, 0.0, 0.5616312736128571,
                       0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                       0.0, 0.0
                   ],
                   [
                       0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                       0.3729650597455687, 0.0, 0.13689999147558637, 0.0,
                       -0.49510851970963143, 0.0, -0.3242569866383592, 0.0,
                       0.6555375364309216, 0.0, -0.24930093301108064, 0.0
                   ],
                   [
                       0.0, 0.4054416537188952, 0.0, -0.6461272852542291, 0.0,
                       -0.18359375, 0.0, 0.41751216299648086, 0.0,
                       0.45838141911581126, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                       0.0, 0.0, 0.0, 0.0, 0.0, 0.0
                   ],
                   [
                       0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                       0.3503396702080488, 0.0, 0.3101412445205158, 0.0,
                       -0.13435455876499874, 0.0, -0.5227282829425685, 0.0,
                       -0.4078478567647231, 0.0, 0.5687166644377318, 0.0
                   ],
                   [
                       0.0, -0.6878550219704731, 0.0, 0.0, 0.0,
                       0.41751216299648086, 0.0, 0.5, 0.0, 0.32021721143623744,
                       0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                       0.0, 0.0
                   ],
                   [
                       0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                       0.3384602766747063, 0.0, 0.4165517012619427, 0.0,
                       0.23534953642800108, 0.0, -0.04764183952207214, 0.0,
                       -0.39401846316690065, 0.0, -0.7064132096745745, 0.0
                   ],
                   [
                       0.0, 0.5873680453541246, 0.0, 0.5616312736128571, 0.0,
                       0.45838141911581126, 0.0, 0.32021721143623744, 0.0,
                       0.1640625, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                       0.0, 0.0, 0.0, 0.0
                   ],
                   [
                       0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                       0.3332125126901468, 0.0, 0.4676500767008183, 0.0,
                       0.4563797439667157, 0.0, 0.43552935783159685, 0.0,
                       0.4002238600878185, 0.0, 0.3348513054006444, 0.0
                   ],
                   [
                       0.5799794739346789, 0.0, 0.41975832570891686, 0.0,
                       0.3729650597455687, 0.0, 0.3503396702080488, 0.0,
                       0.3384602766747063, 0.0, 0.3332125126901468, 0.0, 0.0,
                       0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0
                   ],
                   [
                       0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                       0.0, -0.041015625, 0.0, -0.12498474027950122, 0.0,
                       -0.21561916177558219, 0.0, -0.32136177701094576, 0.0,
                       -0.46501810346249056, 0.0, -0.7852959200243154
                   ],
                   [
                       -0.6887500841864173, 0.0, -0.13594928558824104, 0.0,
                       0.13689999147558637, 0.0, 0.3101412445205158, 0.0,
                       0.4165517012619427, 0.0, 0.4676500767008183, 0.0, 0.0,
                       0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0
                   ],
                   [
                       0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                       0.0, -0.12498474027950122, 0.0, -0.349609375, 0.0,
                       -0.4953107286295218, 0.0, -0.49716719187291986, 0.0,
                       -0.25433782432394114, 0.0, 0.5522286086008462
                   ],
                   [
                       0.4032907544404998, 0.0, -0.5572262544360347, 0.0,
                       -0.49510851970963143, 0.0, -0.13435455876499874, 0.0,
                       0.23534953642800108, 0.0, 0.4563797439667157, 0.0, 0.0,
                       0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0
                   ],
                   [
                       0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                       0.0, -0.21561916177558219, 0.0, -0.4953107286295218,
                       0.0, -0.3857421875, 0.0, 0.1403500730508221, 0.0,
                       0.6844881147156696, 0.0, -0.26675176057529504
                   ],
                   [
                       -0.1584741601909983, 0.0, 0.636036888060459, 0.0,
                       -0.3242569866383592, 0.0, -0.5227282829425685, 0.0,
                       -0.04764183952207214, 0.0, 0.43552935783159685, 0.0,
                       0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0
                   ],
                   [
                       0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                       0.0, -0.32136177701094576, 0.0, -0.49716719187291986,
                       0.0, 0.1403500730508221, 0.0, 0.6279296875, 0.0,
                       -0.47810190182411116, 0.0, 0.08352321608098984
                   ],
                   [
                       0.038323079824899575, 0.0, -0.2950124033243931, 0.0,
                       0.6555375364309216, 0.0, -0.4078478567647231, 0.0,
                       -0.39401846316690065, 0.0, 0.4002238600878185, 0.0, 0.0,
                       0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0
                   ],
                   [
                       0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                       0.0, -0.46501810346249056, 0.0, -0.25433782432394114,
                       0.0, 0.6844881147156696, 0.0, -0.47810190182411116, 0.0,
                       0.1474609375, 0.0, -0.014842464993721351
                   ],
                   [
                       -0.004580484140452568, 0.0, 0.05695963504460033, 0.0,
                       -0.24930093301108064, 0.0, 0.5687166644377318, 0.0,
                       -0.7064132096745745, 0.0, 0.3348513054006444, 0.0, 0.0,
                       0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0
                   ],
                   [
                       0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                       0.0, -0.7852959200243154, 0.0, 0.5522286086008462, 0.0,
                       -0.26675176057529504, 0.0, 0.08352321608098984, 0.0,
                       -0.014842464993721351, 0.0, 0.0009765625
                   ]]),
    )
    if not lv < len(jd):
        raise NotImplementedError(
            f"wigner D maximum l implemented is {len(jd) - 1}, send us an email to ask for more"
        )

    alpha, beta, gamma = broadcast_args(alpha, beta, gamma)
    j = jd[lv]
    xa = _z_rot_mat(alpha, lv)
    xb = _z_rot_mat(beta, lv)
    xc = _z_rot_mat(gamma, lv)
    return xa @ j.astype(ms.float16) @ xb @ j.astype(ms.float16) @ xc


def _z_rot_mat(angle, lv):
    shape = angle.shape
    m = ops.zeros((shape[0], 2 * lv + 1, 2 * lv + 1))
    inds = ops.arange(0, 2 * lv + 1, 1)
    reversed_inds = ops.arange(2 * lv, -1, -1)
    frequencies = ops.arange(lv, -lv - 1, -1)
    m[..., inds, reversed_inds] = ops.sin(frequencies * angle[..., None])
    m[..., inds, inds] = ops.cos(frequencies * angle[..., None])
    return m.astype(ms.float16)
