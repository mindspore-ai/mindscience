# Contents

<!-- TOC -->

- [Contents](#contents)
- [Scattering Parameters Prediction based on Point Cloud Data](#scattering-parameters-prediction-based-on-point-cloud-data)
- [Dataset](#dataset)
- [Environment Requirements](#environment-requirements)
- [Script Description](#script-description)
    - [Script and Sample Code](#script-and-sample-code)
    - [Script Parameters](#script-parameters)
    - [Training Process](#training-process)
    - [Evaluation Process](#evaluation-process)
- [Random Seed Setting](#random-seed-setting)
- [MindScience Home Page](#mindscience-home-page)

<!-- /TOC -->

# Scattering Parameters Prediction based on Point Cloud Data

The classic electromagnetic simulation method is based on finite element method or finite difference method, which requires a lot of iterative calculation, leads to a long time of calculation and cannot meet the requirements of modern product design for simulation efficiency. The AI method directly obtains scattering parameters through end-to-end simulation calculation, skipping iterative calculation, greatly improving the simulation speed and shortening the product R&D period.

In certain product design scenarios, the target structure cannot be described by a fixed set of parameters. For these scenarios, we propose a AI calculation method based on point cloud data for , which can predict the scattering parameters of any complex structure (mobile phone, PCB board, etc.).

# Dataset

Generate scatter parameters prediction input data based on [Point Cloud Data Generation](<https://gitee.com/mindspore/mindscience/tree/master/MindElec/examples/data_driven/pointcloud/generate_pointcloud>) and [Point Cloud Data Compression](<https://gitee.com/mindspore/mindscience/tree/master/MindElec/examples/data_driven/pointcloud/data_compression>). The label needs to be generated by using commercial simulation software or a finite difference time domain algorithm.

The generated dataset need to be normalized and smoothed using the `generate_data` function in `src/data_preprocessing.py`, tutorial can be found in `script description/data preprocessing`.

The model training data in this example involves commercial secrets and the download address cannot be provided. The developer can use `src/sampling.py` to generate pseudo data for functional verification.

# Environment Requirements

- Hardware (Ascend)
    - Prepare the Ascend AI Processor to set up the hardware environment.
- Framework
    - [MindSpore Elec](https://gitee.com/mindspore/mindscience/tree/master/MindElec)
- For more information, see the following resources:
    - [MindSpore Elec Tutorial](https://www.mindspore.cn/mindelec/docs/en/master/intro_and_install.html)
    - [MindSpore Elec Python API](https://www.mindspore.cn/mindelec/docs/en/master/mindelec.architecture.html)

# Script Description

## Script and Sample Code

```path
.
└─S_parameter
  ├─README.md
  ├─src
    ├─config.py                      ## Parameter configuration
    ├─dataset.py                     ## dataset loader
    ├─data_preprocessing.py          ## data preprocessing
    ├─metric.py                      ## Evaluation script
    ├─model.py                       ## Scatter parameters prediction model of point cloud
    ├─lr_generator.py                ## learning rate generate
    ├─sampling.py                    ## pseudo data generation
  ├──train.py                        ## Training network
  ├──eval.py                         ## Evaluation network
```

## Script Parameters

You can configure training parameters in the `src/config.py` file.

```python
'input_channels': 4,                      ## Channel of input tensor
'epochs': 4000,                           ## Training epoch numbers
'batch_size': 8,                          ## Batch size of input tensor
'lr': 0.0001,                             ## Init value of learning rate
'lr_decay_milestones': 5,                 ## Decay epochs of learning rate
```

### Data Preprocessing

Before training or evaluation, you need to call `src/data_preprocessing.py` to normalize and smoothing the data.

``` shell
cd src
python data_preprocessing.py --input_path INPUT_PATH
                             --label_path LABEL_PATH
```

## Training Process

You can train the data compression model through the `train.py`, and the model parameters will be automatically saved after the training.

```shell
python train.py --train_input_path TRAIN_INPUT_PATH
                --train_label_path TRAIN_LABEL_PATH
                --device_num 0
                --checkpoint_dir CKPT_PATH
```

## Evaluation Process

After the model training process, you can start the evaluation process through `eval.py`.

```shell
python eval.py  --input_path TEST_INPUT_PATH
                --label_path TEST_LABEL_PATH
                --data_config_path DATA_CONFIG_PATH
                --device_num 0
                --model_path CKPT_PATH
                --output_path OUTPUT_PATH
```

During the evaluation process, a real-time comparison chart of the predict value and the ture value will be drawn and saved in the output directory.

# Random Seed Setting

The seed of the "create_dataset" function is set in `train.py`.

# MindScience Home Page

Visit the official website [home page](<https://gitee.com/mindspore/mindscience>).
