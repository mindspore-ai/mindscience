# Contents

<!-- TOC -->

- [Contents](#contents)
- [Point Cloud Data Electromagnetic Simulation](#point-cloud-data-electromagnetic-simulation)
- [Dataset](#dataset)
- [Environment Requirements](#environment-requirements)
- [Quick Start](#quick-start)
- [Script Description](#script-description)
    - [Script and Sample Code](#script-and-sample-code)
    - [Script Parameters](#script-parameters)
    - [Training Process](#training-process)
    - [Evaluation Process](#evaluation-process)
- [Random Seed Setting](#random-seed-setting)
- [MindScience Home Page](#mindscience-home-page)

<!-- /TOC -->

# Point Cloud Data Electromagnetic Simulation

The conventional electromagnetic simulation method is based on finite element method or finite difference method, which requires a lot of iterative calculation, leads to a long time of calculation and cannot meet the requirements of modern product design for simulation efficiency. The AI method directly obtains electromagnetic field distribution through end-to-end simulation calculation, skipping iterative calculation, greatly improving the simulation speed and shortening the product R&D period.

# Dataset

Generate electromagnetic field inputs data based on [Point Cloud Data Generation](<https://gitee.com/mindspore/mindscience/tree/master/MindElec/examples/data_driven/pointcloud/generate_pointcloud>) and [Point Cloud Data Compression](<https://gitee.com/mindspore/mindscience/tree/master/MindElec/examples/data_driven/pointcloud/data_compression>), and then call `src/inputs_process.py` to bind the inputs with coordinates and source location information. The abel needs to be generated by using commercial simulation software or a finite difference time domain algorithm, and then `src/label_process.py` is called to obtain the final label. The mobile phone data used in the training and evaluation process involves commercial secrets, so it cannot be displayed to the outside. You can use the `src/sample.py` script to generate random data for model function verification.

# Environment Requirements

- Hardware (Ascend)
    - Prepare the Ascend AI Processor to set up the hardware environment.
- Framework
    - [MindSpore Elec](https://gitee.com/mindspore/mindscience/tree/master/MindElec)
- For more information, see the following resources:
    - [MindSpore Elec Tutorial](https://www.mindspore.cn/mindelec/docs/en/master/intro_and_install.html)
    - [MindSpore Elec Python API](https://www.mindspore.cn/mindelec/docs/en/master/mindelec.architecture.html)

# Quick Start

After installing MindSpore Elec, you can perform the following training and evaluation steps:

- Running in the Ascend AI Processor environment

```python
# Example of Training Process
bash run_train.sh [DATASET_PATH]

# Example of Evaluation Process
bash run_eval.sh [DATASET_PATH] [CHECKPOINT_PATH]
```

# Script Description

## Script and Sample Code

```path
.
└─full_em
    ├─README.md
    ├─scripts
        ├──run_train.sh            # Start Ascend training.
        ├──run_eval.sh             # Start Ascend evaluation.
    ├─src
        ├──input_process.py        # Pre-processes of the training input
        ├──label_process.py        # Pre-processes of the training label.
        ├──config.py               # Parameter configuration
        ├──dataset.py              # Dataset configuration
        ├──loss.py                 # Loss function
        ├──maxwell_model.py        # Electromagnetic simulation model of point cloud data
    ├──train.py #Training network
    ├──eval.py #Evaluate the network
```

## Script Parameters

You can configure training parameters in the src/config.py file.

``` python
"epochs": 500,                 # Training epoch numbers
"batch_size": 8,               # Batch size of input tensor
"lr": 0.00001,                 # Init value of learning rate
"t_solution": 162,             # Time axis resolution
"x_solution": 50,              # Spatial X-axis resolution
"y_solution": 50,              # Spatial Y-axis resolution
"z_solution": 8,               # Spatial Z-axis resolution
"save_checkpoint_epochs": 5,   # Checkpoint Save Interval
"keep_checkpoint_max": 20      # Maximum number of saved checkpoints
```

## Training Process

```shell
bash run_train.sh [DATASET_PATH]
```

Set the following script parameter:

- `DATASET_PATH`: path of the training data

The training result will be stored in the `train` folder in the current path. You can find the checkpoint file and the result in the log.

## Evaluation Process

Check the checkpoint path used for evaluation before running the following command. Set the checkpoint path to an absolute path, for example, `username/train/ckpt/Maxwell3d-5_1275.ckpt`.

```shell
bash run_eval.sh [DATASET_PATH] [CHECKPOINT_PATH]
```

Set the following script parameters:

- `DATASET_PATH`: path of the evaluation dataset
- `CHECKPOINT_PATH`: absolute path of the checkpoint file

Checkpoints are generated during training.

The evaluation result will be stored in the `eval` folder in the example path. You can find the following results in the log:

```shell
test_res: l2_error: 0.9250676897
```

# Random Seed Setting

The seed of the "create_dataset" function is set in dataset.py, and the random seed in train.py is also used.

# MindScience Home Page

Visit the official website [home page](<https://gitee.com/mindspore/mindscience>).
